<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Marksheet Printing System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .input-section, .preview-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        h2 {
            color: #2575fc;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            border-color: #2575fc;
            outline: none;
        }
        
        .btn {
            display: inline-block;
            background: #2575fc;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #1a68e3;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn-print {
            background: #28a745;
            margin-top: 10px;
            width: 100%;
        }
        
        .btn-print:hover {
            background: #218838;
        }
        
        .btn-pdf {
            background: #dc3545;
            margin-top: 10px;
            width: 100%;
        }
        
        .btn-pdf:hover {
            background: #c82333;
        }
        
        .subject-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .subject-row input {
            flex: 1;
        }
        
        .btn-remove {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            width: 40px;
            cursor: pointer;
        }
        
        .btn-remove:hover {
            background: #c82333;
        }
        
        .btn-add {
            background: #17a2b8;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .btn-add:hover {
            background: #138496;
        }
        
        /* Marksheet Preview Styles */
        .marksheet-preview {
            background: white;
            border: 1px solid #ddd;
            padding: 30px;
            min-height: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .marksheet-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #2575fc;
        }
        
        .school-logo {
            max-height: 100px;
            margin-bottom: 15px;
        }
        
        .school-name {
            font-size: 24px;
            font-weight: bold;
            color: #2575fc;
            margin-bottom: 5px;
        }
        
        .marksheet-title {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .info-item {
            margin-bottom: 8px;
        }
        
        .info-label {
            font-weight: 600;
            display: inline-block;
            width: 140px;
        }
        
        .marks-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
        }
        
        .marks-table th {
            background-color: #2575fc;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .marks-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }
        
        .marks-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .summary-item {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .summary-label {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 18px;
            font-weight: bold;
            color: #2575fc;
        }
        
        .signature-area {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }
        
        .signature {
            text-align: center;
        }
        
        .signature-line {
            width: 200px;
            border-top: 1px solid #333;
            margin: 40px auto 5px;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }
        
        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .marksheet-preview, .marksheet-preview * {
                visibility: visible;
            }
            
            .marksheet-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 0;
                box-shadow: none;
                border: none;
            }
            
            .btn-print, .btn-pdf {
                display: none;
            }
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        
        .checkbox-group input {
            width: auto;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #28a745;
            color: white;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }
        
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 5px;
            z-index: 1001;
        }
        
        .pdf-container {
            position: absolute;
            left: -9999px;
            top: -9999px;
        }
    </style>
</head>
<body>
    <div class="notification" id="notification">PDF downloaded successfully!</div>
    <div class="loading" id="loading">Generating PDF, please wait...</div>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-graduation-cap"></i> Exam Marksheet Printing System</h1>
            <p class="subtitle">Create professional exam marksheets with PDF export</p>
        </header>
        
        <section class="input-section">
            <h2><i class="fas fa-edit"></i> Enter Student Details</h2>
            
            <div class="form-group">
                <label for="schoolName">School Name</label>
                <input type="text" id="schoolName" placeholder="Enter school name" value="Greenwood International School">
            </div>
            
            <div class="form-group">
                <label for="logoUrl">School Logo URL (Optional)</label>
                <input type="text" id="logoUrl" placeholder="Enter logo URL" value="https://via.placeholder.com/100x100/2575fc/ffffff?text=GS">
                <div class="checkbox-group">
                    <input type="checkbox" id="includeLogo" checked>
                    <label for="includeLogo">Include logo in marksheet</label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="studentName">Student Name</label>
                <input type="text" id="studentName" placeholder="Enter student name" value="John William Smith">
            </div>
            
            <div class="form-group">
                <label for="rollNumber">Roll Number</label>
                <input type="text" id="rollNumber" placeholder="Enter roll number" value="20230045">
            </div>
            
            <div class="form-group">
                <label for="className">Class</label>
                <input type="text" id="className" placeholder="Enter class" value="10th Grade">
            </div>
            
            <div class="form-group">
                <label for="academicYear">Academic Year</label>
                <input type="text" id="academicYear" placeholder="Enter academic year" value="2022-2023">
            </div>
            
            <div class="form-group">
                <label for="examType">Exam Type</label>
                <select id="examType">
                    <option>Annual Examination</option>
                    <option>Mid-Term Examination</option>
                    <option>Final Examination</option>
                    <option>Unit Test</option>
                </select>
            </div>
            
            <h2 style="margin-top: 30px;"><i class="fas fa-book"></i> Subjects & Marks</h2>
            
            <div id="subjectsContainer">
                <!-- Subject rows will be added here dynamically -->
            </div>
            
            <button class="btn-add" id="addSubject"><i class="fas fa-plus"></i> Add Subject</button>
            
            <button class="btn" id="generateMarksheet"><i class="fas fa-sync-alt"></i> Generate Marksheet</button>
        </section>
        
        <section class="preview-section">
            <h2><i class="fas fa-eye"></i> Marksheet Preview</h2>
            
            <div class="marksheet-preview" id="marksheetPreview">
                <!-- Marksheet content will be generated here -->
                <div class="marksheet-header">
                    <img src="https://via.placeholder.com/100x100/2575fc/ffffff?text=GS" alt="School Logo" class="school-logo" id="previewLogo">
                    <div class="school-name" id="previewSchoolName">Greenwood International School</div>
                    <div class="marksheet-title" id="previewExamType">Annual Examination Marksheet</div>
                    <div>Academic Year: <span id="previewAcademicYear">2022-2023</span></div>
                </div>
                
                <div class="student-info">
                    <div>
                        <div class="info-item"><span class="info-label">Student Name:</span> <span id="previewStudentName">John William Smith</span></div>
                        <div class="info-item"><span class="info-label">Roll Number:</span> <span id="previewRollNumber">20230045</span></div>
                    </div>
                    <div>
                        <div class="info-item"><span class="info-label">Class:</span> <span id="previewClassName">10th Grade</span></div>
                        <div class="info-item"><span class="info-label">Date of Issue:</span> <span id="previewIssueDate">June 15, 2023</span></div>
                    </div>
                </div>
                
                <table class="marks-table">
                    <thead>
                        <tr>
                            <th>Subject</th>
                            <th>Maximum Marks</th>
                            <th>Marks Obtained</th>
                            <th>Grade</th>
                        </tr>
                    </thead>
                    <tbody id="previewSubjects">
                        <!-- Subject rows will be added here -->
                    </tbody>
                </table>
                
                <div class="summary">
                    <div class="summary-item">
                        <div class="summary-label">Total Marks</div>
                        <div class="summary-value" id="previewTotalMarks">500</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Marks Obtained</div>
                        <div class="summary-value" id="previewObtainedMarks">425</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Percentage</div>
                        <div class="summary-value" id="previewPercentage">85%</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Grade</div>
                        <div class="summary-value" id="previewGrade">A</div>
                    </div>
                </div>
                
                <div class="signature-area">
                    <div class="signature">
                        <div class="signature-line"></div>
                        <div>Class Teacher</div>
                    </div>
                    <div class="signature">
                        <div class="signature-line"></div>
                        <div>Principal</div>
                    </div>
                </div>
                
                <div class="footer">
                    <p>This is a computer-generated document and does not require a signature.</p>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-print" id="printMarksheet"><i class="fas fa-print"></i> Print Marksheet</button>
                <button class="btn btn-pdf" id="exportPdf"><i class="fas fa-file-pdf"></i> Export as PDF</button>
            </div>
        </section>
    </div>

    <!-- Hidden container for PDF generation -->
    <div id="pdfContainer" class="pdf-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize with some subjects
            addSubjectRow('Mathematics', 100, 92);
            addSubjectRow('English', 100, 88);
            addSubjectRow('Science', 100, 85);
            addSubjectRow('Social Studies', 100, 90);
            addSubjectRow('Computer Science', 100, 90);
            
            // Generate initial marksheet
            generateMarksheet();
            
            // Add subject button event
            document.getElementById('addSubject').addEventListener('click', function() {
                addSubjectRow('', '', '');
            });
            
            // Generate marksheet button event
            document.getElementById('generateMarksheet').addEventListener('click', generateMarksheet);
            
            // Print marksheet button event
            document.getElementById('printMarksheet').addEventListener('click', function() {
                window.print();
            });
            
            // Export PDF button event
            document.getElementById('exportPdf').addEventListener('click', exportToPdf);
            
            // Function to add a subject row
            function addSubjectRow(subject, maxMarks, obtainedMarks) {
                const container = document.getElementById('subjectsContainer');
                const row = document.createElement('div');
                row.className = 'subject-row';
                row.innerHTML = `
                    <input type="text" class="subject-name" placeholder="Subject" value="${subject}">
                    <input type="number" class="max-marks" placeholder="Max Marks" value="${maxMarks}">
                    <input type="number" class="obtained-marks" placeholder="Obtained" value="${obtainedMarks}">
                    <button class="btn-remove"><i class="fas fa-times"></i></button>
                `;
                container.appendChild(row);
                
                // Add event to remove button
                row.querySelector('.btn-remove').addEventListener('click', function() {
                    row.remove();
                    generateMarksheet();
                });
                
                // Add events to inputs to update marksheet on change
                const inputs = row.querySelectorAll('input');
                inputs.forEach(input => {
                    input.addEventListener('input', generateMarksheet);
                });
            }
            
            // Function to generate the marksheet
            function generateMarksheet() {
                // Update header information
                document.getElementById('previewSchoolName').textContent = 
                    document.getElementById('schoolName').value || 'School Name';
                
                // Handle logo visibility
                const logoElement = document.getElementById('previewLogo');
                const includeLogo = document.getElementById('includeLogo').checked;
                const logoUrl = document.getElementById('logoUrl').value;
                
                if (includeLogo && logoUrl) {
                    logoElement.src = logoUrl;
                    logoElement.style.display = 'block';
                } else {
                    logoElement.style.display = 'none';
                }
                
                document.getElementById('previewStudentName').textContent = 
                    document.getElementById('studentName').value || 'Student Name';
                
                document.getElementById('previewRollNumber').textContent = 
                    document.getElementById('rollNumber').value || 'Roll Number';
                
                document.getElementById('previewClassName').textContent = 
                    document.getElementById('className').value || 'Class';
                
                document.getElementById('previewAcademicYear').textContent = 
                    document.getElementById('academicYear').value || 'Academic Year';
                
                document.getElementById('previewExamType').textContent = 
                    document.getElementById('examType').value + ' Marksheet';
                
                // Update issue date
                const today = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('previewIssueDate').textContent = 
                    today.toLocaleDateString('en-US', options);
                
                // Process subjects and marks
                const subjectRows = document.querySelectorAll('.subject-row');
                const previewSubjects = document.getElementById('previewSubjects');
                previewSubjects.innerHTML = '';
                
                let totalMaxMarks = 0;
                let totalObtainedMarks = 0;
                
                subjectRows.forEach(row => {
                    const subjectName = row.querySelector('.subject-name').value || 'Subject';
                    const maxMarks = parseInt(row.querySelector('.max-marks').value) || 0;
                    const obtainedMarks = parseInt(row.querySelector('.obtained-marks').value) || 0;
                    
                    totalMaxMarks += maxMarks;
                    totalObtainedMarks += obtainedMarks;
                    
                    // Calculate grade
                    let grade = 'F';
                    if (maxMarks > 0) {
                        const percentage = (obtainedMarks / maxMarks) * 100;
                        if (percentage >= 90) grade = 'A+';
                        else if (percentage >= 80) grade = 'A';
                        else if (percentage >= 70) grade = 'B';
                        else if (percentage >= 60) grade = 'C';
                        else if (percentage >= 50) grade = 'D';
                        else grade = 'F';
                    }
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${subjectName}</td>
                        <td>${maxMarks}</td>
                        <td>${obtainedMarks}</td>
                        <td>${grade}</td>
                    `;
                    previewSubjects.appendChild(tr);
                });
                
                // Update summary
                document.getElementById('previewTotalMarks').textContent = totalMaxMarks;
                document.getElementById('previewObtainedMarks').textContent = totalObtainedMarks;
                
                let percentage = 0;
                if (totalMaxMarks > 0) {
                    percentage = ((totalObtainedMarks / totalMaxMarks) * 100).toFixed(2);
                }
                document.getElementById('previewPercentage').textContent = percentage + '%';
                
                // Calculate overall grade
                let overallGrade = 'F';
                if (totalMaxMarks > 0) {
                    const overallPercentage = (totalObtainedMarks / totalMaxMarks) * 100;
                    if (overallPercentage >= 90) overallGrade = 'A+';
                    else if (overallPercentage >= 80) overallGrade = 'A';
                    else if (overallPercentage >= 70) overallGrade = 'B';
                    else if (overallPercentage >= 60) overallGrade = 'C';
                    else if (overallPercentage >= 50) overallGrade = 'D';
                    else overallGrade = 'F';
                }
                document.getElementById('previewGrade').textContent = overallGrade;
            }
            
            // Function to export marksheet as PDF
            function exportToPdf() {
                // Show loading indicator
                document.getElementById('loading').style.display = 'block';
                
                // Create a copy of the marksheet for PDF generation
                const originalElement = document.getElementById('marksheetPreview');
                const pdfContainer = document.getElementById('pdfContainer');
                
                // Clear previous content
                pdfContainer.innerHTML = '';
                
                // Create a clone of the marksheet
                const element = originalElement.cloneNode(true);
                element.style.width = '210mm'; // A4 width
                element.style.padding = '20mm';
                pdfContainer.appendChild(element);
                
                const studentName = document.getElementById('studentName').value || 'Student';
                const className = document.getElementById('className').value || 'Class';
                
                // Configure PDF options
                const options = {
                    margin: 0,
                    filename: `${studentName}_${className}_Marksheet.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        logging: true,
                        scrollX: 0,
                        scrollY: 0
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: 'a4', 
                        orientation: 'portrait',
                        compress: true
                    }
                };
                
                // Generate PDF
                html2pdf().set(options).from(element).save().then(() => {
                    // Hide loading indicator
                    document.getElementById('loading').style.display = 'none';
                    
                    // Show success notification
                    const notification = document.getElementById('notification');
                    notification.style.display = 'block';
                    notification.style.background = '#28a745';
                    notification.textContent = 'PDF downloaded successfully!';
                    
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 3000);
                }).catch(err => {
                    // Hide loading indicator
                    document.getElementById('loading').style.display = 'none';
                    
                    // Show error notification
                    const notification = document.getElementById('notification');
                    notification.style.display = 'block';
                    notification.style.background = '#dc3545';
                    notification.textContent = 'Error generating PDF. Please try again.';
                    
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 3000);
                    
                    console.error('PDF generation error:', err);
                });
            }
        });
    </script>
</body>
</html>
